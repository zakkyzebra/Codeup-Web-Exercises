<!DOCTYPE html>
<html>
<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAaAZUIDBgdbxVygyrXjda2lDhpi7DP_kM"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
	<link rel="stylesheet" type="text/css" href="css/weather_map.css">
	<title>Weather Map</title>
</head>
<body>
	<!-- DIV CONTAINER ALLOWS CSS STYLING. EMPTY DIVS INSIDE FOR MAP AND WEATHER INPUT -->
	<div id="container" class="img-rounded shadow">
		<p class="center_me" id="cityNameHead"></p>
		<div class="forecast shadow img-rounded" id="dayOneWeather">

		</div>
		<div class="forecast shadow img-rounded" id="dayTwoWeather">

		</div>
		<div class="forecast shadow img-rounded" id="dayThreeWeather">

		</div>
		<div id="mapCanvas"></div>
	</div>
	<!-- FORM ASKING FOR ADDRESS INPUT FOR MAP OUTPUT-->
	<form class="center_me" method="post" id="formId">
		<input id="idLong" placeholder="Enter address here"name="address" type="text">
		<input type="submit" value="View Weather">
	</form>

	<!--LET THE FUNCTIONS BEGIN-->
    <script>
		var json;
		var latX;
		var longY;
		//MAP INPUT
		function mapAppear(data) {
			//VARIABLES TO POINT TO THE DIV
			var dayOne = $('#dayOneWeather');
			var dayTwo = $('#dayTwoWeather');
			var dayThree = $('#dayThreeWeather');
			//GRABS CITY PROPERTY AND PUTS IT IN HEADER TAGS
			$('#cityNameHead').append("<h1>"+ data.city.name + "</h1>");
			//ADDS WEATHER DATA AND PUTS IT IN CORRESPONDING DIVS DAY 1
			dayOne.append("<img src='http://openweathermap.org/img/w/" + data.list[0].weather[0].icon + ".png'>");
			dayOne.append("<h3>" + data.city.name + " Day One</h3>");
			dayOne.append("<h4>" + parseInt(data.list[0].temp.max) + "°/ " + parseInt(data.list[0].temp.min) + "°</h4>");
			dayOne.append( "<strong>" + data.list[0].weather[0].main + "</strong>: " + data.list[0].weather[0].description + "<br>");
			dayOne.append("Humidity: " + data.list[0].humidity + "<br>");
			dayOne.append("Wind: " + data.list[0].speed + "<br>");
			dayOne.append("Pressure: " + data.list[0].pressure + "<br>");
			//ADDS WEATHER DATA AND PUTS IT IN CORRESPONDING DIVS DAY 2
			dayTwo.append("<img src='http://openweathermap.org/img/w/" + data.list[1].weather[0].icon + ".png'>");
			dayTwo.append("<h3>" + data.city.name + " Day Two</h3>");
			dayTwo.append("<h4>" + parseInt(data.list[1].temp.max) + "°/ " + parseInt(data.list[1].temp.min) + "°</h4>");
			dayTwo.append( "<strong>" + data.list[1].weather[0].main + "</strong>: " + data.list[1].weather[0].description + "<br>");
			dayTwo.append("Humidity: " + data.list[1].humidity + "<br>");
			dayTwo.append("Wind: " + data.list[1].speed + "<br>");
			dayTwo.append("Pressure: " + data.list[1].pressure + "<br>");
			//ADDS WEATHER DATA AND PUTS IT IN CORRESPONDING DIVS DAY 3
			dayThree.append("<img src='http://openweathermap.org/img/w/" + data.list[2].weather[0].icon + ".png'>");
			dayThree.append("<h3>" + data.city.name + " Day Three</h3>");
			dayThree.append("<h4>" + parseInt(data.list[2].temp.max) + "°/ " + parseInt(data.list[2].temp.min) + "°</h4>");
			dayThree.append( "<strong>" + data.list[2].weather[0].main + "</strong>: " + data.list[2].weather[0].description + "<br>");
			dayThree.append("Humidity: " + data.list[2].humidity + "<br>");
			dayThree.append("Wind: " + data.list[2].speed + "<br>");
			dayThree.append("Pressure: " + data.list[2].pressure + "<br>");
		};
		//DEFAULT WEATHER LOCATION IS YOUR LOCATION
    	navigator.geolocation.getCurrentPosition(function(position){
    		//MAKES AJEX REQUEST FOR LAT AND LONG
			var ajaxReq = $.get("http://api.openweathermap.org/data/2.5/forecast/daily?lat=" + position.coords.latitude + "&lon=" + position.coords.longitude + "&cnt=3", {
			    APPID: "54c825c0e86eedb19afe64cac578e6c7",
			    units: "imperial"
			});
			ajaxReq.always(function(){
				console.log('req sent');
			});
			ajaxReq.fail(function(data, error){
				console.log('error');
				console.log(ajaxReq.status);
			});
			ajaxReq.done(function(data){
				mapAppear(data);
				console.log('done');	
			});
		});
    	//FORM INPUT ON CLICK FUNCTION
	    $('#formId').on('submit',function (e) {
	    	//PREVENTS RELOAD
            e.preventDefault();
            //MAKING IT AN ARRAY FOR EASY USE
        	json = $('form').serializeArray();
        	//EMPTY THE DIVS TO MAKE SURE THERE IS ROOM FOR THE NEXT WEATHER INPUT
        	$('#dayOneWeather, #dayTwoWeather, #dayThreeWeather, #cityNameHead').html("");
        	//GETTING THE VALUES FOR THE MAP
            var address = json[0].value;
			var geocoder = new google.maps.Geocoder();
			//MAKING THE MAP HAPPEN
			geocoder.geocode( { 'address': address}, function(results, status) {
				if (status == google.maps.GeocoderStatus.OK) {
				    var mapOptions = {
				    	zoom: 15,
				    	center: results[0].geometry.location
				    }
				    latX = results[0].geometry.location.A;
				    longY = results[0].geometry.location.F;
				} else {
					alert("Geocoding was not successful - STATUS: " + status);
				}

				var ajaxReq = $.get("http://api.openweathermap.org/data/2.5/forecast/daily?lat=" + latX + "&lon=" + longY + "&cnt=3", {
				    APPID: "54c825c0e86eedb19afe64cac578e6c7",
				    units: "imperial"
				});

				ajaxReq.always(function(){
					console.log('req sent');
				});
				ajaxReq.fail(function(data, error){
					console.log('error');
					console.log(ajaxReq.status);
				});
				ajaxReq.done(function(data){
					mapAppear(data);
					console.log('done')
				});	
			    var map = new google.maps.Map(document.getElementById("mapCanvas"), mapOptions);
			});
        });

    </script>


</body>
</html>