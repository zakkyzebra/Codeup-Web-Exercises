<!DOCTYPE html>
<html>
<head>
	<title>Weather Map</title>
	<style type="text/css">
	.forecast{
		display: inline-block;
		padding: 5px 15px 5px 10px;
		background-color: lightYellow;
	}
	#container {
		background-color: lightBlue;
		padding: 10px 10px 10px 10px;
		text-align: center;

	}
	#mapCanvas{
		width: 400px;
		height: 350px;
		text-align: center;
		margin-left: auto;
		margin-right: auto;
	}
	</style>
</head>
<body>
	<form method="post" id="formId">
		address: <input id="idLong" name="address" type="text"><br>
		<input type="submit">
	</form>
	<div id="container">
		<p id="cityNameHead"></p>
		<div class="forecast" id="dayOneWeather">

		</div>
		<div class="forecast" id="dayTwoWeather">

		</div>
		<div class="forecast" id="dayThreeWeather">

		</div>
		<div id="mapCanvas"></div>
	</div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAaAZUIDBgdbxVygyrXjda2lDhpi7DP_kM"></script>

    <script>
    "use strict";
		var json;
		var latX;
		var longY;
    	var ajaxReq = $.get("http://api.openweathermap.org/data/2.5/forecast/daily?q=bulverde,4677392&cnt=3", {
		    APPID: "54c825c0e86eedb19afe64cac578e6c7",
		    units: "imperial"
		});

		ajaxReq.always(function(){
			console.log('req sent');
		});
		ajaxReq.fail(function(data, error){
			console.log('error');
			console.log(ajaxReq.status);
		});
		ajaxReq.done(function(data){
			var dayOne = $('#dayOneWeather');
			var dayTwo = $('#dayTwoWeather');
			var dayThree = $('#dayThreeWeather');
			$('#cityNameHead').append("<h1>"+ data.city.name + "</h1>");
			dayOne.append("<img src='http://openweathermap.org/img/w/" + data.list[0].weather[0].icon + ".png'>");
			dayOne.append("<h3>" + data.city.name + " Day One</h3>");
			dayOne.append("<h4>" + parseInt(data.list[0].temp.max) + "°/ " + parseInt(data.list[0].temp.min) + "°</h4>");
			dayOne.append( "<strong>" + data.list[0].weather[0].main + "</strong>: " + data.list[0].weather[0].description + "<br>");
			dayOne.append("Humidity: " + data.list[0].humidity + "<br>");
			dayOne.append("Wind: " + data.list[0].speed + "<br>");
			dayOne.append("Pressure: " + data.list[0].pressure + "<br>");

			dayTwo.append("<img src='http://openweathermap.org/img/w/" + data.list[1].weather[0].icon + ".png'>");
			dayTwo.append("<h3>" + data.city.name + " Day Two</h3>");
			dayTwo.append("<h4>" + parseInt(data.list[1].temp.max) + "°/ " + parseInt(data.list[1].temp.min) + "°</h4>");
			dayTwo.append( "<strong>" + data.list[1].weather[0].main + "</strong>: " + data.list[1].weather[0].description + "<br>");
			dayTwo.append("Humidity: " + data.list[1].humidity + "<br>");
			dayTwo.append("Wind: " + data.list[1].speed + "<br>");
			dayTwo.append("Pressure: " + data.list[1].pressure + "<br>");

			dayThree.append("<img src='http://openweathermap.org/img/w/" + data.list[2].weather[0].icon + ".png'>");
			dayThree.append("<h3>" + data.city.name + " Day Three</h3>");
			dayThree.append("<h4>" + parseInt(data.list[2].temp.max) + "°/ " + parseInt(data.list[2].temp.min) + "°</h4>");
			dayThree.append( "<strong>" + data.list[2].weather[0].main + "</strong>: " + data.list[2].weather[0].description + "<br>");
			dayThree.append("Humidity: " + data.list[2].humidity + "<br>");
			dayThree.append("Wind: " + data.list[2].speed + "<br>");
			dayThree.append("Pressure: " + data.list[2].pressure + "<br>");

		});
	    $('#formId').on('submit',function (e) {
            e.preventDefault();
        	json = $('form').serializeArray();
        	$('#dayOneWeather, #dayTwoWeather, #dayThreeWeather, #cityNameHead').html("");
            var address = json[0].value;
			var geocoder = new google.maps.Geocoder();

			geocoder.geocode( { 'address': address}, function(results, status) {
				if (status == google.maps.GeocoderStatus.OK) {
				    var mapOptions = {
				    	zoom: 15,
				    	center: results[0].geometry.location
				    }
				    latX = results[0].geometry.location.A;
				    longY = results[0].geometry.location.F;
				    var map = new google.maps.Map(document.getElementById("mapCanvas"), mapOptions);

				    var marker = new google.maps.Marker({
				    	position: results[0].geometry.location,
				    	map: map
				    });

				    var infowindow = new google.maps.InfoWindow({
				        content: "Viewing Pointer's Weather"
				    });

				    infowindow.open(map,marker);
				} else {
					alert("Geocoding was not successful - STATUS: " + status);
				}

				var ajaxReq2 = $.get("http://api.openweathermap.org/data/2.5/forecast/daily?lat=" + latX + "&lon=" + longY + "&cnt={cnt}", {
				    APPID: "54c825c0e86eedb19afe64cac578e6c7",
				    units: "imperial"
				});

				ajaxReq2.always(function(){
					console.log('req sent');
				});
				ajaxReq2.fail(function(data, error){
					console.log('error');
					console.log(ajaxReq2.status);
				});
				ajaxReq2.done(function(data){
					console.log(data);
					var dayOne = $('#dayOneWeather');
					var dayTwo = $('#dayTwoWeather');
					var dayThree = $('#dayThreeWeather');
					$('#cityNameHead').append("<h1>"+ data.city.name + "</h1>");
					dayOne.append("<img src='http://openweathermap.org/img/w/" + data.list[0].weather[0].icon + ".png'>");
					dayOne.append("<h3>" + data.city.name + " Day One</h3>");
					dayOne.append("<h4>" + parseInt(data.list[0].temp.max) + "°/ " + parseInt(data.list[0].temp.min) + "°</h4>");
					dayOne.append( "<strong>" + data.list[0].weather[0].main + "</strong>: " + data.list[0].weather[0].description + "<br>");
					dayOne.append("Humidity: " + data.list[0].humidity + "<br>");
					dayOne.append("Wind: " + data.list[0].speed + "<br>");
					dayOne.append("Pressure: " + data.list[0].pressure + "<br>");

					dayTwo.append("<img src='http://openweathermap.org/img/w/" + data.list[1].weather[0].icon + ".png'>");
					dayTwo.append("<h3>" + data.city.name + " Day Two</h3>");
					dayTwo.append("<h4>" + parseInt(data.list[1].temp.max) + "°/ " + parseInt(data.list[1].temp.min) + "°</h4>");
					dayTwo.append( "<strong>" + data.list[1].weather[0].main + "</strong>: " + data.list[1].weather[0].description + "<br>");
					dayTwo.append("Humidity: " + data.list[1].humidity + "<br>");
					dayTwo.append("Wind: " + data.list[1].speed + "<br>");
					dayTwo.append("Pressure: " + data.list[1].pressure + "<br>");

					dayThree.append("<img src='http://openweathermap.org/img/w/" + data.list[2].weather[0].icon + ".png'>");
					dayThree.append("<h3>" + data.city.name + " Day Three</h3>");
					dayThree.append("<h4>" + parseInt(data.list[2].temp.max) + "°/ " + parseInt(data.list[2].temp.min) + "°</h4>");
					dayThree.append( "<strong>" + data.list[2].weather[0].main + "</strong>: " + data.list[2].weather[0].description + "<br>");
					dayThree.append("Humidity: " + data.list[2].humidity + "<br>");
					dayThree.append("Wind: " + data.list[2].speed + "<br>");
					dayThree.append("Pressure: " + data.list[2].pressure + "<br>");

				});	
			    var map = new google.maps.Map(document.getElementById("mapCanvas"), mapOptions);
			});
        });
	// navigator.geolocation.getCurrentPosition(function(position){
	// 	console.log(position)
	// 	getWeather(position.coords.latitude, position.coords.longitude);
	// });
		

    </script>


</body>
</html>